{"queries":[{"id":"link_data","compiledQueryString":"SELECT \n    DISTINCT region,\n    '/' || region as link\nFROM \n    regions\nWHERE region IS NOT NULL","inputQueryString":"SELECT \n    DISTINCT region,\n    '/' || region as link\nFROM \n    regions\nWHERE region IS NOT NULL","compiled":false,"inline":true},{"id":"category","compiledQueryString":"SELECT\n  *\nFROM\n  (SELECT \n    'market_cap' as metric, 'Perception' as category,  'usd' as unit, 2 as \"order\"\n  UNION ALL\n  SELECT 'intrinsic_value', 'Performance', 'usd', 1\n  UNION ALL\n  SELECT 'tsr', 'Pay off', 'pct', 3)\nORDER BY \"order\"","inputQueryString":"SELECT\n  *\nFROM\n  (SELECT \n    'market_cap' as metric, 'Perception' as category,  'usd' as unit, 2 as \"order\"\n  UNION ALL\n  SELECT 'intrinsic_value', 'Performance', 'usd', 1\n  UNION ALL\n  SELECT 'tsr', 'Pay off', 'pct', 3)\nORDER BY \"order\"","compiled":false,"inline":true},{"id":"pay_offs","compiledQueryString":"SELECT\n  *\nFROM\n  (SELECT \n    'tsr' as metric, 'TSR' as metric_name, 1 as \"order\"\n  UNION ALL\n  SELECT 'discount_or_premium', 'Discount/Premium', 2)\nORDER BY \"order\"","inputQueryString":"SELECT\n  *\nFROM\n  (SELECT \n    'tsr' as metric, 'TSR' as metric_name, 1 as \"order\"\n  UNION ALL\n  SELECT 'discount_or_premium', 'Discount/Premium', 2)\nORDER BY \"order\"","compiled":false,"inline":true},{"id":"sectors","compiledQueryString":"SELECT\n    DISTINCT sector\nFROM\n    regions\nWHERE sector IS NOT NULL","inputQueryString":"SELECT\n    DISTINCT sector\nFROM\n    regions\nWHERE sector IS NOT NULL","compiled":false,"inline":true},{"id":"years","compiledQueryString":"WITH min_max AS (\n    SELECT \n        MIN(year) as min_year,\n        MAX(year) as max_year\n    FROM regions\n    WHERE year IS NOT NULL\n)\nSELECT \n    distinct r.year,\n    m.min_year,\n    m.max_year\nFROM \n    regions r\nCROSS JOIN min_max m\nWHERE r.year IS NOT NULL\nORDER BY r.year","inputQueryString":"WITH min_max AS (\n    SELECT \n        MIN(year) as min_year,\n        MAX(year) as max_year\n    FROM regions\n    WHERE year IS NOT NULL\n)\nSELECT \n    distinct r.year,\n    m.min_year,\n    m.max_year\nFROM \n    regions r\nCROSS JOIN min_max m\nWHERE r.year IS NOT NULL\nORDER BY r.year","compiled":false,"inline":true},{"id":"base_data","compiledQueryString":"WITH overall_coords AS (\n  SELECT \n    region,\n    MEDIAN(lat) as overall_lat,\n    MEDIAN(long) as overall_long\n  FROM regions\n  WHERE region IS NOT NULL\n  GROUP BY region\n),\nbase_data AS (\n  SELECT\n    r.region,\n    AVG(market_cap) as \"Market capitalization\",\n    AVG(sqrt(market_cap)) as log_market_cap,\n    AVG(intrinsic_value) as \"Intrinsic value\",\n    AVG(sqrt(intrinsic_value)) as log_intrinsic_value,\n    (AVG(market_cap) - AVG(intrinsic_value))/AVG(intrinsic_value) as discount_or_premium,\n    AVG(tsr) as tsr,\n    oc.overall_lat as lat,\n    oc.overall_long as long\n  FROM regions r\n  JOIN overall_coords oc ON r.region = oc.region\n  WHERE year = ${inputs.year_slider} \n    AND r.region IS NOT NULL \n    AND sector IN ${inputs.sector_multi.value}\n  GROUP BY r.region, oc.overall_lat, oc.overall_long\n)\nSELECT \n    base_data.*,\n    CASE \n        WHEN tsr = 0 THEN 0\n        WHEN tsr > 0 THEN tsr * (MAX(ABS(tsr)) OVER () / MAX(tsr) OVER ())\n        ELSE tsr * (MAX(ABS(tsr)) OVER () / ABS(MIN(tsr) OVER ()))\n    END as \"Total shareholder return\",\n    (tsr - MIN(tsr) OVER ()) / (MAX(tsr) OVER () - MIN(tsr) OVER ()) + 0.02 as normalized_tsr,\n    CASE \n        WHEN discount_or_premium = 0 THEN 0\n        WHEN discount_or_premium > 0 THEN discount_or_premium * (MAX(ABS(discount_or_premium)) OVER () / MAX(discount_or_premium) OVER ())\n        ELSE discount_or_premium * (MAX(ABS(discount_or_premium)) OVER () / ABS(MIN(discount_or_premium) OVER ()))\n    END as \"Discount/Premium\",\n    (discount_or_premium - MIN(discount_or_premium) OVER ()) / (MAX(discount_or_premium) OVER () - MIN(discount_or_premium) OVER ()) + 0.02 as normalized_dp\nFROM base_data","inputQueryString":"WITH overall_coords AS (\n  SELECT \n    region,\n    MEDIAN(lat) as overall_lat,\n    MEDIAN(long) as overall_long\n  FROM regions\n  WHERE region IS NOT NULL\n  GROUP BY region\n),\nbase_data AS (\n  SELECT\n    r.region,\n    AVG(market_cap) as \"Market capitalization\",\n    AVG(sqrt(market_cap)) as log_market_cap,\n    AVG(intrinsic_value) as \"Intrinsic value\",\n    AVG(sqrt(intrinsic_value)) as log_intrinsic_value,\n    (AVG(market_cap) - AVG(intrinsic_value))/AVG(intrinsic_value) as discount_or_premium,\n    AVG(tsr) as tsr,\n    oc.overall_lat as lat,\n    oc.overall_long as long\n  FROM regions r\n  JOIN overall_coords oc ON r.region = oc.region\n  WHERE year = ${inputs.year_slider} \n    AND r.region IS NOT NULL \n    AND sector IN ${inputs.sector_multi.value}\n  GROUP BY r.region, oc.overall_lat, oc.overall_long\n)\nSELECT \n    base_data.*,\n    CASE \n        WHEN tsr = 0 THEN 0\n        WHEN tsr > 0 THEN tsr * (MAX(ABS(tsr)) OVER () / MAX(tsr) OVER ())\n        ELSE tsr * (MAX(ABS(tsr)) OVER () / ABS(MIN(tsr) OVER ()))\n    END as \"Total shareholder return\",\n    (tsr - MIN(tsr) OVER ()) / (MAX(tsr) OVER () - MIN(tsr) OVER ()) + 0.02 as normalized_tsr,\n    CASE \n        WHEN discount_or_premium = 0 THEN 0\n        WHEN discount_or_premium > 0 THEN discount_or_premium * (MAX(ABS(discount_or_premium)) OVER () / MAX(discount_or_premium) OVER ())\n        ELSE discount_or_premium * (MAX(ABS(discount_or_premium)) OVER () / ABS(MIN(discount_or_premium) OVER ()))\n    END as \"Discount/Premium\",\n    (discount_or_premium - MIN(discount_or_premium) OVER ()) / (MAX(discount_or_premium) OVER () - MIN(discount_or_premium) OVER ()) + 0.02 as normalized_dp\nFROM base_data","compiled":false,"inline":true},{"id":"regions","compiledQueryString":"SELECT \n    *\nFROM\n    (WITH overall_coords AS (\n  SELECT \n    region,\n    MEDIAN(lat) as overall_lat,\n    MEDIAN(long) as overall_long\n  FROM regions\n  WHERE region IS NOT NULL\n  GROUP BY region\n),\nbase_data AS (\n  SELECT\n    r.region,\n    AVG(market_cap) as \"Market capitalization\",\n    AVG(sqrt(market_cap)) as log_market_cap,\n    AVG(intrinsic_value) as \"Intrinsic value\",\n    AVG(sqrt(intrinsic_value)) as log_intrinsic_value,\n    (AVG(market_cap) - AVG(intrinsic_value))/AVG(intrinsic_value) as discount_or_premium,\n    AVG(tsr) as tsr,\n    oc.overall_lat as lat,\n    oc.overall_long as long\n  FROM regions r\n  JOIN overall_coords oc ON r.region = oc.region\n  WHERE year = ${inputs.year_slider} \n    AND r.region IS NOT NULL \n    AND sector IN ${inputs.sector_multi.value}\n  GROUP BY r.region, oc.overall_lat, oc.overall_long\n)\nSELECT \n    base_data.*,\n    CASE \n        WHEN tsr = 0 THEN 0\n        WHEN tsr > 0 THEN tsr * (MAX(ABS(tsr)) OVER () / MAX(tsr) OVER ())\n        ELSE tsr * (MAX(ABS(tsr)) OVER () / ABS(MIN(tsr) OVER ()))\n    END as \"Total shareholder return\",\n    (tsr - MIN(tsr) OVER ()) / (MAX(tsr) OVER () - MIN(tsr) OVER ()) + 0.02 as normalized_tsr,\n    CASE \n        WHEN discount_or_premium = 0 THEN 0\n        WHEN discount_or_premium > 0 THEN discount_or_premium * (MAX(ABS(discount_or_premium)) OVER () / MAX(discount_or_premium) OVER ())\n        ELSE discount_or_premium * (MAX(ABS(discount_or_premium)) OVER () / ABS(MIN(discount_or_premium) OVER ()))\n    END as \"Discount/Premium\",\n    (discount_or_premium - MIN(discount_or_premium) OVER ()) / (MAX(discount_or_premium) OVER () - MIN(discount_or_premium) OVER ()) + 0.02 as normalized_dp\nFROM base_data) b\nJOIN (SELECT \n    DISTINCT region,\n    '/' || region as link\nFROM \n    regions\nWHERE region IS NOT NULL) l ON b.region = l.region","inputQueryString":"SELECT \n    *\nFROM\n    ${base_data} b\nJOIN ${link_data} l ON b.region = l.region","compiled":true,"inline":true},{"id":"pos_tsr","compiledQueryString":"SELECT\n  tsr\nFROM\n  (SELECT \n    *\nFROM\n    (WITH overall_coords AS (\n  SELECT \n    region,\n    MEDIAN(lat) as overall_lat,\n    MEDIAN(long) as overall_long\n  FROM regions\n  WHERE region IS NOT NULL\n  GROUP BY region\n),\nbase_data AS (\n  SELECT\n    r.region,\n    AVG(market_cap) as \"Market capitalization\",\n    AVG(sqrt(market_cap)) as log_market_cap,\n    AVG(intrinsic_value) as \"Intrinsic value\",\n    AVG(sqrt(intrinsic_value)) as log_intrinsic_value,\n    (AVG(market_cap) - AVG(intrinsic_value))/AVG(intrinsic_value) as discount_or_premium,\n    AVG(tsr) as tsr,\n    oc.overall_lat as lat,\n    oc.overall_long as long\n  FROM regions r\n  JOIN overall_coords oc ON r.region = oc.region\n  WHERE year = ${inputs.year_slider} \n    AND r.region IS NOT NULL \n    AND sector IN ${inputs.sector_multi.value}\n  GROUP BY r.region, oc.overall_lat, oc.overall_long\n)\nSELECT \n    base_data.*,\n    CASE \n        WHEN tsr = 0 THEN 0\n        WHEN tsr > 0 THEN tsr * (MAX(ABS(tsr)) OVER () / MAX(tsr) OVER ())\n        ELSE tsr * (MAX(ABS(tsr)) OVER () / ABS(MIN(tsr) OVER ()))\n    END as \"Total shareholder return\",\n    (tsr - MIN(tsr) OVER ()) / (MAX(tsr) OVER () - MIN(tsr) OVER ()) + 0.02 as normalized_tsr,\n    CASE \n        WHEN discount_or_premium = 0 THEN 0\n        WHEN discount_or_premium > 0 THEN discount_or_premium * (MAX(ABS(discount_or_premium)) OVER () / MAX(discount_or_premium) OVER ())\n        ELSE discount_or_premium * (MAX(ABS(discount_or_premium)) OVER () / ABS(MIN(discount_or_premium) OVER ()))\n    END as \"Discount/Premium\",\n    (discount_or_premium - MIN(discount_or_premium) OVER ()) / (MAX(discount_or_premium) OVER () - MIN(discount_or_premium) OVER ()) + 0.02 as normalized_dp\nFROM base_data) b\nJOIN (SELECT \n    DISTINCT region,\n    '/' || region as link\nFROM \n    regions\nWHERE region IS NOT NULL) l ON b.region = l.region)\nWHERE tsr >= 0","inputQueryString":"SELECT\n  tsr\nFROM\n  ${regions}\nWHERE tsr >= 0","compiled":true,"inline":true},{"id":"pos_dp","compiledQueryString":"SELECT\n  discount_or_premium\nFROM\n  (SELECT \n    *\nFROM\n    (WITH overall_coords AS (\n  SELECT \n    region,\n    MEDIAN(lat) as overall_lat,\n    MEDIAN(long) as overall_long\n  FROM regions\n  WHERE region IS NOT NULL\n  GROUP BY region\n),\nbase_data AS (\n  SELECT\n    r.region,\n    AVG(market_cap) as \"Market capitalization\",\n    AVG(sqrt(market_cap)) as log_market_cap,\n    AVG(intrinsic_value) as \"Intrinsic value\",\n    AVG(sqrt(intrinsic_value)) as log_intrinsic_value,\n    (AVG(market_cap) - AVG(intrinsic_value))/AVG(intrinsic_value) as discount_or_premium,\n    AVG(tsr) as tsr,\n    oc.overall_lat as lat,\n    oc.overall_long as long\n  FROM regions r\n  JOIN overall_coords oc ON r.region = oc.region\n  WHERE year = ${inputs.year_slider} \n    AND r.region IS NOT NULL \n    AND sector IN ${inputs.sector_multi.value}\n  GROUP BY r.region, oc.overall_lat, oc.overall_long\n)\nSELECT \n    base_data.*,\n    CASE \n        WHEN tsr = 0 THEN 0\n        WHEN tsr > 0 THEN tsr * (MAX(ABS(tsr)) OVER () / MAX(tsr) OVER ())\n        ELSE tsr * (MAX(ABS(tsr)) OVER () / ABS(MIN(tsr) OVER ()))\n    END as \"Total shareholder return\",\n    (tsr - MIN(tsr) OVER ()) / (MAX(tsr) OVER () - MIN(tsr) OVER ()) + 0.02 as normalized_tsr,\n    CASE \n        WHEN discount_or_premium = 0 THEN 0\n        WHEN discount_or_premium > 0 THEN discount_or_premium * (MAX(ABS(discount_or_premium)) OVER () / MAX(discount_or_premium) OVER ())\n        ELSE discount_or_premium * (MAX(ABS(discount_or_premium)) OVER () / ABS(MIN(discount_or_premium) OVER ()))\n    END as \"Discount/Premium\",\n    (discount_or_premium - MIN(discount_or_premium) OVER ()) / (MAX(discount_or_premium) OVER () - MIN(discount_or_premium) OVER ()) + 0.02 as normalized_dp\nFROM base_data) b\nJOIN (SELECT \n    DISTINCT region,\n    '/' || region as link\nFROM \n    regions\nWHERE region IS NOT NULL) l ON b.region = l.region)\nWHERE discount_or_premium >= 0","inputQueryString":"SELECT\n  discount_or_premium\nFROM\n  ${regions}\nWHERE discount_or_premium >= 0","compiled":true,"inline":true}]}